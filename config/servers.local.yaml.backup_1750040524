# Remote Terminal MCP æœåŠ¡å™¨é…ç½®æ¨¡æ¿
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º servers.local.yaml å¹¶ä¿®æ”¹ä¸ºä½ çš„å®é™…é…ç½®

# æœåŠ¡å™¨é…ç½®
servers:
  # ç¤ºä¾‹1ï¼šç›´æ¥SSHè¿æ¥
  gpu-server-01:
    type: "direct_ssh"
    host: "your-gpu-server.example.com"     # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€
    port: 22
    username: "xuyehua"               # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
    private_key_path: "~/.ssh/id_rsa"      # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç§é’¥è·¯å¾„
    description: "GPUè®­ç»ƒæœåŠ¡å™¨"
    
    # æœåŠ¡å™¨ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    specs:
      gpu_count: 8
      gpu_type: "Tesla A100"
      memory: "512GB"
      cpu_cores: 64
    
    # é»˜è®¤ä¼šè¯é…ç½®
    session:
      name: "gpu-work"
      working_directory: "/workspace"
      shell: "/bin/zsh"
      environment:
        CUDA_VISIBLE_DEVICES: "0,1,2,3,4,5,6,7"
        PYTHONPATH: "/workspace:/workspace/src"
  
  # ç¤ºä¾‹2ï¼šé€šè¿‡è·³æ¿æœºè¿æ¥
  secure-server:
    type: "jump_ssh"
    host: "internal-server.company.com"     # ğŸ“ æœ€ç»ˆç›®æ ‡æœåŠ¡å™¨
    port: 22
    username: "xuyehua"               # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
    private_key_path: "~/.ssh/company_key"  # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç§é’¥
    description: "å†…ç½‘å®‰å…¨æœåŠ¡å™¨"
    
    # è·³æ¿æœºé…ç½®
    jump_host:
      host: "bastion.company.com"          # ğŸ“ è·³æ¿æœºåœ°å€
      port: 22
      username: "xuyehua"            # ğŸ“ è·³æ¿æœºç”¨æˆ·å
      private_key_path: "~/.ssh/bastion_key"  # ğŸ“ è·³æ¿æœºç§é’¥
    
    session:
      name: "secure-work"
      working_directory: "/home/xuyehua"
      shell: "/bin/bash"
  
  # ç¤ºä¾‹3ï¼šå¼€å‘æµ‹è¯•æœåŠ¡å™¨
  dev-server:
    type: "direct_ssh"
    host: "dev.example.com"                 # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„å¼€å‘æœåŠ¡å™¨
    port: 2222                              # ğŸ“ éæ ‡å‡†ç«¯å£ç¤ºä¾‹
    username: "developer"                   # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
    private_key_path: "~/.ssh/dev_key"     # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç§é’¥
    description: "å¼€å‘æµ‹è¯•ç¯å¢ƒ"
    
    specs:
      gpu_count: 2
      gpu_type: "RTX 3090"
      memory: "64GB"
      cpu_cores: 16
    
    session:
      name: "dev-session"
      working_directory: "/home/developer/projects"
      shell: "/bin/zsh"
      environment:
        NODE_ENV: "development"
        PYTHONPATH: "/home/developer/projects"
  
  # ç¤ºä¾‹4ï¼šCPUè®¡ç®—æœåŠ¡å™¨
  cpu-server:
    type: "direct_ssh"
    host: "cpu-cluster.example.com"         # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„CPUæœåŠ¡å™¨
    port: 22
    username: "xuyehua"               # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
    private_key_path: "~/.ssh/id_rsa"      # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„ç§é’¥
    description: "CPUå¯†é›†è®¡ç®—æœåŠ¡å™¨"
    
    specs:
      gpu_count: 0
      memory: "256GB"
      cpu_cores: 128
    
    session:
      name: "cpu-work"
      working_directory: "/data/projects"
      shell: "/bin/bash"
      environment:
        OMP_NUM_THREADS: "32"
        MKL_NUM_THREADS: "16"

# å…¨å±€è®¾ç½®
global_settings:
  default_server: "gpu-server-01"          # ğŸ“ ä¿®æ”¹ä¸ºä½ çš„é»˜è®¤æœåŠ¡å™¨
  connection_timeout: 30                   # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  command_timeout: 300                     # å‘½ä»¤æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  auto_reconnect: true                     # æ–­çº¿è‡ªåŠ¨é‡è¿
  max_retry_attempts: 3                    # æœ€å¤§é‡è¯•æ¬¡æ•°
  
  # SSHå…¨å±€é€‰é¡¹
  ssh_options:
    ServerAliveInterval: 60                # ä¿æ´»é—´éš”ï¼ˆç§’ï¼‰
    ServerAliveCountMax: 3                 # æœ€å¤§ä¿æ´»æ¬¡æ•°
    StrictHostKeyChecking: "no"            # æ˜¯å¦ä¸¥æ ¼æ£€æŸ¥ä¸»æœºå¯†é’¥
    UserKnownHostsFile: "/dev/null"        # å·²çŸ¥ä¸»æœºæ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒå¯è®¾ä¸º/dev/nullï¼‰
    ConnectTimeout: 10                     # SSHè¿æ¥è¶…æ—¶

# å®‰å…¨é…ç½®
security:
  # å…è®¸çš„å‘½ä»¤æ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
  allowed_commands:
    - "^ls.*"                              # ls ç›¸å…³å‘½ä»¤
    - "^pwd$"                              # pwd å‘½ä»¤
    - "^cd .*"                             # cd å‘½ä»¤
    - "^mkdir .*"                          # mkdir å‘½ä»¤
    - "^cat .*"                            # cat å‘½ä»¤
    - "^head .*"                           # head å‘½ä»¤
    - "^tail .*"                           # tail å‘½ä»¤
    - "^ps .*"                             # ps å‘½ä»¤
    - "^nvidia-smi.*"                      # nvidia-smi å‘½ä»¤
    - "^python.*"                          # python ç›¸å…³å‘½ä»¤
    - "^pip.*"                             # pip ç›¸å…³å‘½ä»¤
    - "^git .*"                            # git å‘½ä»¤
    - "^tmux.*"                            # tmux å‘½ä»¤
  
  # ç¦æ­¢çš„å‘½ä»¤æ¨¡å¼
  forbidden_commands:
    - "^rm -rf /$"                         # å±é™©çš„åˆ é™¤å‘½ä»¤
    - "^sudo .*"                           # sudo å‘½ä»¤ï¼ˆæ ¹æ®éœ€è¦è°ƒæ•´ï¼‰
    - "^su .*"                             # su å‘½ä»¤
    - ".*passwd.*"                         # å¯†ç ç›¸å…³å‘½ä»¤

# ================================================================
# ğŸ“š é…ç½®å®Œæˆåçš„ä½¿ç”¨æ–¹æ³•ï¼š
# ================================================================
# 
# 1ï¸âƒ£ å¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼š
#    cp config/servers.template.yaml config/servers.local.yaml
#
# 2ï¸âƒ£ ç¼–è¾‘æœ¬åœ°é…ç½®ï¼š
#    nano config/servers.local.yaml
#    ï¼ˆä¿®æ”¹æ‰€æœ‰æ ‡è®°ä¸º ğŸ“ çš„é…ç½®é¡¹ï¼‰
#
# 3ï¸âƒ£ åœ¨Cursorä¸­ä½¿ç”¨ï¼š
#    "è¿æ¥åˆ°gpu-server-01"
#    "åœ¨dev-serverä¸Šæ‰§è¡Œ nvidia-smi"
#    "åˆ—å‡ºæ‰€æœ‰é…ç½®çš„æœåŠ¡å™¨"
#
# ================================================================

# âš ï¸ é‡è¦å®‰å…¨æé†’ï¼š
# 1. è¯·å°†æ‰€æœ‰ç¤ºä¾‹åœ°å€ã€ç”¨æˆ·åã€å¯†é’¥è·¯å¾„æ›¿æ¢ä¸ºä½ çš„å®é™…é…ç½®
# 2. æ­¤æ¨¡æ¿æ–‡ä»¶å¯ä»¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
# 3. å®é™…é…ç½®æ–‡ä»¶ servers.local.yaml ä¸ä¼šè¢«æäº¤ï¼ˆå·²åŠ å…¥gitignoreï¼‰
# 4. ç¡®ä¿SSHç§é’¥æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆchmod 600ï¼‰
# 5. å®šæœŸæ›´æ¢SSHå¯†é’¥å¯¹æé«˜å®‰å…¨æ€§ 